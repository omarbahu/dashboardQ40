@model dynamic

@{
    ViewData["Title"] = "Dashboard Arca Planta Insurgentes";
}
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px auto;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    th, td {
        text-align: center;
        padding: 10px;
        border: 1px solid #ddd;
    }

    th {
        background-color: #007BFF;
        color: #fff;
    }

    td {
        background-color: #f9f9f9;
        cursor: pointer;
    }

    .chart-container {
        width: 100px;
        height: 50px;
        margin: 0 auto;
    }

    .status-ok {
        color: green;
        font-weight: bold;
    }

    .status-alert {
        color: orange;
        font-weight: bold;
    }
</style>

<h1 style="text-align:center;">Dashboard Resumen de Líneas</h1>

<table>
    <thead>
        <tr>
            <th>Línea</th>
            <th>Variable</th>
            <th>Valor</th>
            <th>Min</th>
            <th>Max</th>
            <th>OK</th>
            <th>Alerta</th>
            <th>Minigráfico</th>
        </tr>
    </thead>
    <tbody id="table-body">
        <!-- Las filas se generarán dinámicamente -->
    </tbody>
</table>



@section Scripts {

    <script>
        // Datos simulados para líneas y variables
        const linesData = [
            { line: "Línea 1", variables: ["Carbonatación", "Brix", "Torque"] },
            { line: "Línea 2", variables: ["Carbonatación", "Brix", "Torque"] },
            { line: "Línea 3", variables: ["Carbonatación", "Brix", "Torque"] },
            { line: "Línea 4", variables: ["Carbonatación", "Brix", "Torque"] },
        ];

        const tableBody = document.getElementById("table-body");
        window.onload = function () {
            // Código para generar las filas y gráficos
            linesData.forEach((lineData) => {
                // Fila para la línea
                const lineRow = document.createElement("tr");
                const lineCell = document.createElement("td");
                lineCell.textContent = lineData.line;
                lineCell.colSpan = 8; // Colspan para abarcar todas las columnas
                lineRow.appendChild(lineCell);
                tableBody.appendChild(lineRow);

                lineData.variables.forEach((variable) => {
                    const row = document.createElement("tr");

                    // Celda vacía para la línea
                    const emptyLineCell = document.createElement("td");
                    row.appendChild(emptyLineCell);

                    // Celda de variable
                    const variableCell = document.createElement("td");
                    variableCell.textContent = variable;
                    row.appendChild(variableCell);

                    // Generar valores aleatorios para la variable
                    const value = parseFloat((Math.random() * 4 + 6).toFixed(1)); // Valor entre 6 y 10
                    const min = 6;
                    const max = 8;

                    // Celdas de valores
                    const valueCell = document.createElement("td");
                    valueCell.textContent = value;
                    row.appendChild(valueCell);

                    const minCell = document.createElement("td");
                    minCell.textContent = min;
                    row.appendChild(minCell);

                    const maxCell = document.createElement("td");
                    maxCell.textContent = max;
                    row.appendChild(maxCell);

                    // Estado OK/Alerta
                    const okCell = document.createElement("td");
                    const alertCell = document.createElement("td");

                    if (value >@Localizer["=min&&value"] <= max) {
                        okCell.innerHTML = `<span class="status-ok">🟢</span>@Localizer["@Localizer["`;"]"]
                        alertCell.innerHTML = "";
                    } else {
                        okCell.innerHTML = "";
                        alertCell.innerHTML = `<span class="status-alert">🟠</span>@Localizer["@Localizer["`;"]"]
                    }

                    row.appendChild(okCell);
                    row.appendChild(alertCell);

                    // Minigráfico
                    const chartCell = document.createElement("td");
                    const chartContainer = document.createElement("div");
                    chartContainer.className = "chart-container";
                    chartContainer.id = `chart-${lineData.line.replace(/\s+/g, "-")}-${variable.replace(/\s+/g, "-")}@Localizer["`;"]

                    chartCell.appendChild(chartContainer);
                    row.appendChild(chartCell);

                    // Renderizar el gráfico después de un pequeño retraso
                    const data = generateRandomData(10); // Datos aleatorios para la gráfica
                    setTimeout(() => {
                        if (document.getElementById(chartContainer.id)) {
                            try {
                                renderChart(chartContainer.id, data);
                            } catch (error) {
                                console.error("Error al renderizar la gráfica:", error);
                            }
                        } else {
                            console.error("El contenedor del gráfico no se encontró:", chartContainer.id);
                        }
                    }, 100);

                    // Hacer clic para enviar datos al servidor
                    row.addEventListener("click", () => {
                        submitSelection(lineData.line, variable, value, min, max);
                    });

                    tableBody.appendChild(row);
                });
            });
        };

        // Generar datos aleatorios
        function generateRandomData(count) {
            const data = [];
            for (let i = 0; i < count; i++) {
                data.push([i, (Math.random() * 4 + 6).toFixed(1)]); // Valores entre 6 y 10
            }
            return data;
        }

        // Renderizar gráfica en miniatura
        function renderChart(containerId, data) {
            const chart = echarts.init(document.getElementById(containerId));
            const option = {
                grid: { left: 0, right: 0, top: 0, bottom: 0 },
                xAxis: { type: "category", show: false, data: data.map((d) => d[0]) },
                yAxis: { type: "value", show: false },
                series: [
                    {
                        type: "line",
                        data: data.map((d) => d[1]),
                        smooth: true,
                        lineStyle: { color: "#007BFF" },
                    },
                ],
                tooltip: { trigger: "axis" },
            };
            chart.setOption(option);
        }

        // Enviar selección al servidor
        function submitSelection(line, variable, value, min, max) {
            const data = {
                line,
                variable,
                value,
                min,
                max,
            };

            fetch("/YourController/SubmitSelection", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data),
            }).then((response) => {
                if (response.ok) {
                    window.location.href = "/YourController/Result";
                }
            });
        }
    </script>


}
